{# Navbar component pour l'admin #}

<nav class="main-header navbar navbar-expand navbar-white navbar-light">
    <!-- Left navbar links -->
    <ul class="navbar-nav">
        <li class="nav-item">
            <a class="nav-link" data-widget="pushmenu" href="#" role="button">
                <i class="fas fa-bars"></i>
            </a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <a href="{{ path('admin_dashboard') }}" class="nav-link">
                <i class="fas fa-home"></i> Dashboard
            </a>
        </li>
        <li class="nav-item d-none d-sm-inline-block">
            <a href="{{ path('app_homepage') }}" class="nav-link" target="_blank">
                <i class="fas fa-external-link-alt"></i> Voir le site
            </a>
        </li>
    </ul>

    <!-- Right navbar links -->
    <ul class="navbar-nav ml-auto">
        <!-- Search -->
        <li class="nav-item">
            <a class="nav-link" data-widget="navbar-search" href="#" role="button">
                <i class="fas fa-search"></i>
            </a>
            <div class="navbar-search-block">
                <form class="form-inline" action="{{ path('admin_search') }}" method="get">
                    <div class="input-group input-group-sm">
                        <input class="form-control form-control-navbar" type="search"
                               placeholder="Rechercher..." aria-label="Search" name="q">
                        <div class="input-group-append">
                            <button class="btn btn-navbar" type="submit">
                                <i class="fas fa-search"></i>
                            </button>
                            <button class="btn btn-navbar" type="button" data-widget="navbar-search">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </li>

        <!-- Messages Dropdown -->
        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#">
                <i class="far fa-comments"></i>
                {% if pendingMessages > 0 %}
                    <span class="badge badge-danger navbar-badge">{{ pendingMessages }}</span>
                {% endif %}
            </a>
            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                <span class="dropdown-header">{{ pendingMessages }} message(s) en attente</span>
                {% for message in recentMessages|slice(0, 3) %}
                    <div class="dropdown-divider"></div>
                    <a href="{{ path('admin_message_show', {'id': message.id}) }}" class="dropdown-item">
                        <div class="media">
                            {% if message.sender.profilePicture %}
                                <img src="{{ asset('uploads/users/' ~ message.sender.profilePicture) }}"
                                     alt="User Avatar" class="img-size-50 mr-3 img-circle">
                            {% else %}
                                <div class="img-size-50 mr-3 img-circle bg-secondary d-flex align-items-center justify-content-center">
                                    <i class="fas fa-user"></i>
                                </div>
                            {% endif %}
                            <div class="media-body">
                                <h3 class="dropdown-item-title">
                                    {{ message.sender.fullName }}
                                    <span class="float-right text-sm text-warning"><i class="fas fa-star"></i></span>
                                </h3>
                                <p class="text-sm">{{ message.content|truncate(50) }}</p>
                                <p class="text-sm text-muted">
                                    <i class="far fa-clock mr-1"></i> {{ message.createdAt|ago }}
                                </p>
                            </div>
                        </div>
                    </a>
                {% endfor %}
                <div class="dropdown-divider"></div>
                <a href="{{ path('admin_message_pending') }}" class="dropdown-item dropdown-footer">
                    Voir tous les messages
                </a>
            </div>
        </li>

        <!-- Notifications Dropdown -->
        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#">
                <i class="far fa-bell"></i>
                {% if notifications|length > 0 %}
                    <span class="badge badge-warning navbar-badge">{{ notifications|length }}</span>
                {% endif %}
            </a>
            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                <span class="dropdown-header">{{ notifications|length }} notification(s)</span>
                {% for notification in notifications|slice(0, 5) %}
                    <div class="dropdown-divider"></div>
                    <a href="{{ notification.url|default('#') }}" class="dropdown-item">
                        <i class="fas fa-{{ notification.icon|default('info') }} mr-2 text-{{ notification.type|default('info') }}"></i>
                        {{ notification.message }}
                        <span class="float-right text-muted text-sm">{{ notification.createdAt|ago }}</span>
                    </a>
                {% endfor %}
                <div class="dropdown-divider"></div>
                <a href="{{ path('admin_notifications') }}" class="dropdown-item dropdown-footer">
                    Voir toutes les notifications
                </a>
            </div>
        </li>

        <!-- Quick Actions -->
        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#">
                <i class="fas fa-plus-circle"></i>
            </a>
            <div class="dropdown-menu dropdown-menu-right">
                <a href="{{ path('admin_user_new') }}" class="dropdown-item">
                    <i class="fas fa-user-plus mr-2"></i> Nouvel utilisateur
                </a>
                <a href="{{ path('admin_property_new') }}" class="dropdown-item">
                    <i class="fas fa-home mr-2"></i> Nouvelle propriété
                </a>
                <div class="dropdown-divider"></div>
                <a href="{{ path('admin_analytics_export') }}" class="dropdown-item">
                    <i class="fas fa-download mr-2"></i> Exporter les données
                </a>
            </div>
        </li>

        <!-- User Account -->
        <li class="nav-item dropdown">
            <a class="nav-link" data-toggle="dropdown" href="#">
                {% if app.user.profilePicture %}
                    <img src="{{ asset('uploads/users/' ~ app.user.profilePicture) }}"
                         class="img-circle elevation-2"
                         alt="User Image"
                         style="width: 30px; height: 30px;">
                {% else %}
                    <i class="fas fa-user-circle"></i>
                {% endif %}
            </a>
            <div class="dropdown-menu dropdown-menu-lg dropdown-menu-right">
                <span class="dropdown-header">
                    {{ app.user.fullName }}<br>
                    <small>{{ app.user.email }}</small>
                </span>
                <div class="dropdown-divider"></div>
                <a href="{{ path('admin_profile') }}" class="dropdown-item">
                    <i class="fas fa-user mr-2"></i> Mon profil
                </a>
                <a href="{{ path('admin_settings') }}" class="dropdown-item">
                    <i class="fas fa-cog mr-2"></i> Paramètres
                </a>
                <div class="dropdown-divider"></div>
                <a href="{{ path('admin_activity_log') }}" class="dropdown-item">
                    <i class="fas fa-history mr-2"></i> Historique d'activité
                </a>
                <div class="dropdown-divider"></div>
                <a href="{{ path('app_logout') }}" class="dropdown-item">
                    <i class="fas fa-sign-out-alt mr-2"></i> Déconnexion
                </a>
            </div>
        </li>

        <!-- Control Sidebar -->
        <li class="nav-item">
            <a class="nav-link" data-widget="control-sidebar" data-slide="true" href="#" role="button">
                <i class="fas fa-th-large"></i>
            </a>
        </li>
    </ul>
</nav>
